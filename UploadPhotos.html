<html>

    <head>

        <title>Smart Bid Client</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    </head>

    <body>

        <script src="./sources/HttpRestAPIClient.js"></script>
        <script src="./sources/GlobalsForClient.js"></script>
        <script src="./sources/ProcessFormInput.js"></script>
        <script src="./sources/ClientInputValidator.js"></script>


        <nav class="navbar navbar-default">

            <div class="row  bg-info">

                <div class="navbar-brand col-lg-1 text-center">
                    <a href="./HomePage.html">Smart Bid Client</a>
                </div>

                <div class="col-lg-8">

                    <ul class="nav navbar-nav row">

                        <li class="col-lg-2"><a href="./HomePage.html">Home</a></li>
                        <li class="col-lg-2"><a href="./PublishAuction.html">Publish Auction</a></li> 
                        <li class="col-lg-2"><a href="./ViewAuction.html">View Auctions</a></li>
                        <li class="col-lg-2"><a href="./CloseAuction.html">Close Auctions</a></li>
                        <li class="col-lg-2"><a href="./UploadPhotos.html">Upload Photos</a></li>

                    </ul>

                </div>

                <div class="col-lg-3">

                    <ul class="nav navbar-nav navbar-right row col-lg-12">

                        <li class="col-lg-3"><a href="./HomePage.html">SignUp</a></li>
                        <li class="col-lg-3"><a href="./LogIn.html">Login</a></li>

                    </ul>

                </div>

            </div>

        </nav>

        <br/><br/><br/>

        <div class="container">

            <form enctype="multipart/form-data" onsubmit="UploadAuctionData(event)">

                <div class="form-group row">

                    <label class="col-lg-4 text-center">Asset Type</label>
                    <input type="text" placeholder="Enter Asset Type" class="col-lg-6" id="id_asset_type"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">MinAuctionPrice</label>
                    <input type="text" placeholder="Enter Minimum Auction Price" class="col-lg-6" id="id_min_auction_price"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">Address</label>
                    <input type="text" placeholder="Enter Address" class="col-lg-6" id="id_address"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">Colony</label>
                    <input type="text" placeholder="Enter Colony" class="col-lg-6" id="id_colony"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">City</label>
                    <input type="text" placeholder="Enter City" class="col-lg-6" id="id_city"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">State</label>
                    <input type="text" placeholder="Enter State" class="col-lg-6" id="id_state"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">Country</label>
                    <input type="text" placeholder="Enter Country" class="col-lg-6" id="id_country"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">ApprovalType</label>
                    <input type="text" placeholder="Enter ApprovalType" class="col-lg-6" id="id_approval_type"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">AssetSize</label>
                    <input type="text" placeholder="Enter Asset Size" class="col-lg-6" id="id_asset_size"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">BuiltUpArea</label>
                    <input type="text" placeholder="Enter BuiltUp Area" class="col-lg-6" id="id_built_up_area"/>

                </div>

                <br/>

                <div class="form-group row">

                    <label class="col-lg-4 text-center">Files To Be Uploaded</label>
                    <input type="file" class="col-lg-6" name="uploadFilesNames" multiple id="id_files_To_Be_Uploaded"/>

                </div>

                <br/><br/><br/>

                <div class="align-middle row">

                    <label class="col-lg-3"></label>
                    <button type="submit" class="btn btn-primary align-middle col-lg-2 border-primary-subtle">Upload Files</button>

                </div>

                <br/><br/><br/>

            </form>

        </div>

        <script>

            async function UploadAuctionData(event)
            {
                event.preventDefault();

                let auctionAssetInputObject = {};

                // Process Form Input Data

                auctionAssetInputObject = ProcessFormInputModule.processInputDataFromForm( auctionAssetInputObject,
                    GlobalsForClientModule.auctionAssetKeysForUpload,
                    GlobalsForClientModule.auctionAssetUIIdsForUpload
                );

                // Validate form input data
                
                if( !ClientInputValidatorModule.validateUserInputObject(auctionAssetInputObject, 
                        GlobalsForClientModule.auctionAssetKeysForUpload) )
                {
                    alert("One or more of Auction Asset Input values are missing");
                    return;
                }

                // Create Form Data Input Object
                
                let inputFormData = ProcessFormInputModule.createFormInputData(auctionAssetInputObject, 
                    GlobalsForClientModule.auctionAssetKeysForUpload);

                console.log(" CurrentUser_CustomerId from Cache = " + window.localStorage.getItem("CurrentUser_CustomerId") );
                inputFormData.append( "SellerCustomerId" , window.localStorage.getItem("CurrentUser_CustomerId") );

                // Upload files
                
                let uploadedFiles = document.getElementById("id_files_To_Be_Uploaded").files;

                if( uploadedFiles.length > GlobalsForClientModule.maxFilesUploadCount )
                {
                    alert("Maximum of 10 files can be uploaded to the Server...Please re-upload");
                    return;
                }

                for( let i = 0 ; i < uploadedFiles.length; i++ )
                {
                    inputFormData.append("file" + i.toString(), uploadedFiles[i]);
                }

                console.log("Sending File Input based Http Request to Server : ");

                HttpRestAPIClientModule.sendHttpFileUploadRequestToSmartBidServerWithCallback( "UploadAuctionPhotos", 
                    inputFormData, successResponseUploadAuctionPhotos, failureResponseUploadAuctionPhotos );
            }

            function successResponseUploadAuctionPhotos(responseTextFromServer)
            {
                window.location.replace("./UploadPhotos.html");
            }

            function failureResponseUploadAuctionPhotos()
            {
                alert("File upload of Auction Photos failed");
                window.location.reload();
            }
            
        </script>

    </body>


</html>